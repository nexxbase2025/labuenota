
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>LA PELI DE LA SEMANA</title>
<style>
  body {margin:0; padding:0; background:black; overflow:hidden;}
  video {
    width:100vw; height:100vh;
    object-fit:contain;
    background:black;
  }
  #backButton {
    position: fixed;
    top: 20px; left: 20px;
    background: rgba(0,0,0,0.6);
    color: #fff;
    border: none; border-radius: 50%;
    padding: 10px 15px; font-size: 18px;
    cursor: pointer;
    display: none; z-index: 10000;
  }
  #adOverlay {
    position: fixed;
    top:0; left:0;
    width:100vw; height:100vh;
    background:black;
    display:none;
    justify-content:center;
    align-items:center;
    z-index: 9999;
  }
  #adOverlay video {
    width:100%; height:100%;
    object-fit:contain;
  }
  /* Mensaje sutil para Android cuando el anuncio requiere toque */
  #tapHint {
    position:absolute; bottom: 14px; left: 50%; transform: translateX(-50%);
    padding: 8px 12px; font-size: 14px; border-radius: 999px;
    background: rgba(0,0,0,0.6); color:#fff; display:none;
  }
</style>
</head>
<body>

<video id="movie" controls playsinline webkit-playsinline>
  <source src="https://ia800802.us.archive.org/5/items/idiocracia-2006-brrip-m-720p-x-264-ac-3-es/Idiocracia%20%282006%29%20%5BBRrip%20m720p%20x264%20AC3%28ES%29%5D.mp4" type="video/mp4">
  Tu navegador no soporta el video.
</video>

<button id="backButton">⟵</button>

<div id="adOverlay">
  <video id="adVideo" playsinline webkit-playsinline>
    <source src="https://ia601300.us.archive.org/15/items/youtube-L4PVw0oaZSo/L4PVw0oaZSo.mp4" type="video/mp4">
    Tu navegador no soporta el video de anuncio.
  </video>
  <div id="tapHint">Toca para reproducir el anuncio</div>
</div>

<script>
const movie = document.getElementById('movie');
const backButton = document.getElementById('backButton');
const adOverlay = document.getElementById('adOverlay');
const adVideo = document.getElementById('adVideo');
const tapHint = document.getElementById('tapHint');

const adInterval = 10*60; // 10 minutos
let nextAdTime = adInterval;
let adPlaying = false;
let userInteracted = false;
let hideTimeout;

// Detect Android
const isAndroid = /Android/i.test(navigator.userAgent);

// Mostrar burbuja de regresar al tocar (y marcar interacción de usuario)
document.addEventListener('click', () => {
  backButton.style.display = 'block';
  userInteracted = true;
  clearTimeout(hideTimeout);
  hideTimeout = setTimeout(()=>{ backButton.style.display='none'; }, 4000);
});
backButton.addEventListener('click', ()=>{ window.location.href='index.html'; });

// Ajuste de tamaño ante rotación/cambios (sin forzar fullscreen ni landscape)
function adjustVideoSize(){
  const w = window.innerWidth;
  const h = window.innerHeight;
  movie.style.width = w + "px";
  movie.style.height = h + "px";
  adVideo.style.width = w + "px";
  adVideo.style.height = h + "px";
}
window.addEventListener('resize', adjustVideoSize);
window.addEventListener('orientationchange', adjustVideoSize);
adjustVideoSize();

// ---- Anuncios cada 10 min: usar timeupdate (más fiable en Android que setInterval) ----
movie.addEventListener('timeupdate', () => {
  if (!adPlaying && movie.currentTime >= nextAdTime) {
    playAd();
    nextAdTime += adInterval;
  }
});

// NO forzar fullscreen ni lock de orientación (solo Android): dejamos que gire al rotar
// movie.addEventListener('play', ... )  --> Eliminado a petición

// ---- Reproducción del anuncio, robusto para Android ----
function playAd(){
  adPlaying = true;
  movie.pause();
  adOverlay.style.display = 'flex';
  tapHint.style.display = 'none';

  // Preparar el video del anuncio desde el inicio
  adVideo.pause();
  try { adVideo.currentTime = 0; } catch(e) {}
  // En Android, si no hubo interacción previa, arrancamos en mute para evitar bloqueo
  adVideo.muted = isAndroid ? !userInteracted : false;
  adVideo.load();

  const startAd = () => {
    adVideo.play()
      .then(() => {
        // Si inició bien y hubo interacción, intentamos habilitar audio
        if (isAndroid && userInteracted && adVideo.muted) {
          // intentar activar audio (algunas veces requiere un toque adicional)
          adVideo.muted = false;
          adVideo.play().catch(() => { /* si falla, se queda en mute */ });
        }
        // Opcional: ocultar controles si se habían mostrado como respaldo
        if (isAndroid) adVideo.controls = false;
        tapHint.style.display = 'none';
      })
      .catch(() => {
        // Respaldo para Android: mostrar controles y pedir toque
        if (isAndroid) {
          adVideo.controls = true;
          tapHint.style.display = 'block';
        }
      });
  };

  // Intento inmediato
  startAd();

  // Si Android sigue bloqueando, permitir toque directo sobre el overlay para iniciar con audio
  const tapToPlay = () => {
    userInteracted = true;
    adVideo.muted = false; // intenta con audio tras el toque
    startAd();
  };
  adOverlay.addEventListener('touchstart', tapToPlay, { once:true });
  adOverlay.addEventListener('click', tapToPlay, { once:true });
}

// Cuando termina el anuncio, volver a la película
adVideo.addEventListener('ended', ()=>{
  adOverlay.style.display = 'none';
  adPlaying = false;
  // Asegurar reanudación
  movie.play().catch(()=>{});
});

// Primer toque desbloquea audio en iOS/Android (mantengo tu comportamiento)
document.addEventListener('touchstart', ()=>{
  movie.load();
  adVideo.load();
}, {once:true});
</script>

</body>
</html>























