
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<link rel="apple-touch-icon" href="icono.webp" />
<title>RADIO MAX SOLO EXITOS</title>
<link rel="manifest" href="manifest.json" />
<link rel="stylesheet" href="style.css" />
<style>
  /* Reset básico */
  body {
    margin: 0; padding: 0;
    font-family: Arial, sans-serif;
    background: #121212;
    color: #fff;
    overflow-x: hidden;
  }
  img#logo {
    position: fixed;
    top: 15px;
    left: 50%;
    transform: translateX(-50%);
    width: 200px;
    z-index: 9999;
  }

  /* Galería deslizable (centrada) */
  .gallery-scroll {
    position: fixed;
    bottom: 200px;
    left: 0;
    width: 100%;
    overflow-x: auto;
    display: flex;
    gap: 10px;
    padding-left: 50vw;
    padding-right: 50vw;
    box-sizing: border-box;
    z-index: 9998;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
    justify-content: flex-start;
    scroll-padding-left: 50vw;
    scroll-padding-right: 50vw;
  }
  .gallery-item {
    flex: 0 0 auto;
    width: 70vw;
    aspect-ratio: 16 / 9;
    scroll-snap-align: center;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0,0,0,0.6);
  }
  .gallery-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    border-radius: 12px;
  }

  /* Redes sociales - burbujas */
  .social-row-abajo {
    position: fixed;
    bottom: 130px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 15px;
    z-index: 10000;
  }
  .social-row-abajo a {
    background: #fff;
    padding: 10px;
    border-radius: 50%;
    box-shadow: 0 4px 10px rgba(0,0,0,0.4);
    display: flex;
    justify-content: center;
    align-items: center;
    transition: transform 0.3s ease;
  }
  .social-row-abajo a:hover {
    transform: scale(1.15);
  }
  .social-row-abajo img {
    width: 26px;
    height: 26px;
  }

  /* Reproductor radio */
  .radio-player {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: #222;
    padding: 12px 20px;
    border-radius: 25px;
    display: flex;
    align-items: center;
    gap: 15px;
    box-shadow: 0 0 20px #ff6a00aa;
    z-index: 10002;
  }
  .play-btn {
    font-size: 26px;
    width: 48px;
    height: 48px;
    border: none;
    border-radius: 50%;
    background: #ff6a00;
    color: white;
    cursor: pointer;
    box-shadow: 0 0 10px #ff6a00;
    display: flex;
    justify-content: center;
    align-items: center;
    user-select: none;
  }
  .play-btn:focus {
    outline: 2px solid #fff;
  }
  .spectrum {
    display: flex;
    justify-content: center;
    align-items: flex-end;
    gap: 4px;
    height: 40px;
    width: 150px;
    margin: auto;
    margin-top: 10px;
    z-index: 999;
  }
  .bar {
    width: 4px;
    background: lime;
    animation: bounce 1s infinite ease-in-out;
    transition: height 0.1s ease;
  }

  /* Burbuja instalar Android */
  #install-bubble {
    display: none;
    position: fixed;
    bottom: 80px;
    right: 20px;
    background: #ff6a00;
    color: white;
    padding: 10px 15px;
    border-radius: 25px;
    font-weight: bold;
    font-size: 15px;
    cursor: pointer;
    box-shadow: 0 0 15px #ff6a00cc;
    z-index: 99999;
  }

  /* Burbuja aviso iOS */
  #ios-install-prompt {
    position: fixed;
    bottom: 20px;
    left: 20px;
    right: 20px;
    background: rgba(0,0,0,0.9);
    color: white;
    padding: 16px;
    border-radius: 12px;
    font-size: 14px;
    text-align: center;
    z-index: 99999;
    box-shadow: 0 4px 12px rgba(0,0,0,0.5);
    display: none;
  }
  #ios-install-prompt button {
    margin-top: 8px;
    background: #ff4444;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
  }

  /* Burbuja peli */
  #peli-bubble {
    position: fixed;
    bottom: 180px;
    left: 50%;
    transform: translateX(-50%);
    background: #ff6a00;
    color: white;
    padding: 10px 15px;
    border-radius: 25px;
    font-weight: bold;
    font-size: 15px;
    cursor: pointer;
    box-shadow: 0 0 15px #ff6a00cc;
    z-index: 99999;
    text-align: center;
  }

  @keyframes fadeIn {
    from {opacity: 0; transform: translateX(-50%) translateY(10px);}
    to {opacity: 1; transform: translateX(-50%) translateY(0);}
  }
</style>
</head>
<body>

  <!-- Logo arriba -->
  <img src="ivibra.webp" id="logo" alt="Logo Ivibra" />

  <!-- Burbuja LA PELI DE LA SEMANA -->
  <div id="peli-bubble" onclick="window.location.href='peli.html'">🎬 LA PELI DE LA SEMANA</div>

  <!-- Redes sociales -->
  <nav class="social-row-abajo" aria-label="Redes sociales">
    <a href="https://wa.me/14699822453" target="_blank" rel="noopener" aria-label="WhatsApp">
      <img src="what.webp" alt="WhatsApp" />
    </a>
    <a href="https://www.facebook.com/radiomaxsda" target="_blank" rel="noopener" aria-label="Facebook">
      <img src="face.webp" alt="Facebook" />
    </a>
    <a href="https://www.instagram.com/guillermo_villagran_delgado/reel/DGLaDCZJuHX/" target="_blank" rel="noopener" aria-label="Instagram">
      <img src="ins.webp" alt="Instagram" />
    </a>
    <a href="https://www.tiktok.com/@radiomaxsoloexitos" target="_blank" rel="noopener" aria-label="TikTok">
      <img src="tik.webp" alt="TikTok" />
    </a>
  </nav>

  <!-- Galería deslizable -->
  <div class="gallery-scroll" aria-label="Galería de promociones">
    <div class="gallery-item"><img src="r1.webp" alt="Promo 1" /></div>
    <div class="gallery-item"><img src="r2.webp" alt="Promo 2" /></div>
    <div class="gallery-item"><img src="r3.webp" alt="Promo 3" /></div>
    <div class="gallery-item"><img src="r4.webp" alt="Promo 4" /></div>
    <div class="gallery-item"><img src="r5.webp" alt="Promo 5" /></div>
    <div class="gallery-item"><img src="r6.webp" alt="Promo 6" /></div>
  </div>

  <!-- Reproductor -->
  <div class="radio-player" role="region" aria-label="Control de reproducción de radio">
    <button class="play-btn" id="playPauseBtn" aria-label="Reproducir o pausar radio">▶</button>
    <div class="spectrum" id="spectrum" aria-hidden="true"></div>
  </div>

  <audio id="audio" preload="auto" src="https://stream.zeno.fm/yv4pxfcq6igvv"></audio>

  <!-- Burbuja instalar Android -->
  <div id="install-bubble" role="button" tabindex="0" aria-label="Instalar aplicación">📲 Instalar app</div>

  <!-- Burbuja aviso instalación iOS -->
  <div id="ios-install-prompt" role="alert" aria-live="assertive" aria-atomic="true">
    📲 Para instalar esta app en iPhone, pulsa el botón de <strong>Compartir</strong> y luego <strong>Añadir a pantalla de inicio</strong>.
    <br />
    <button id="closeIosPromptBtn" aria-label="Cerrar aviso de instalación iOS">Cerrar</button>
  </div>

<script>
  const audio = document.getElementById('audio');
  const playPauseBtn = document.getElementById('playPauseBtn');
  const spectrum = document.getElementById('spectrum');
  const installBubble = document.getElementById('install-bubble');
  const iosInstallPrompt = document.getElementById('ios-install-prompt');
  const closeIosPromptBtn = document.getElementById('closeIosPromptBtn');

  let isPlaying = false;
  let animationId;
  let deferredPrompt;

  // Crear barras espectro
  const bars = [];
  for(let i=0; i<16; i++){
    const bar = document.createElement('div');
    bar.className = 'bar';
    spectrum.appendChild(bar);
    bars.push(bar);
  }

  function animateFakeSpectrum(){
    bars.forEach(bar => {
      const h = Math.random() * 100;
      bar.style.height = `${h}%`;
    });
    const scale = 1 + Math.random() * 0.1;
    const logo = document.getElementById('logo');
    if(logo){
      logo.style.transform = `translateX(-50%) scale(${scale})`;
    }
    animationId = requestAnimationFrame(animateFakeSpectrum);
  }

  playPauseBtn.addEventListener('click', () => {
    if(!isPlaying){
      audio.manualPaused = false;
      audio.pause();
      audio.src = 'https://stream.zeno.fm/yv4pxfcq6igvv';
      audio.load();
      audio.play().then(() => {
        playPauseBtn.textContent = '⏸';
        isPlaying = true;
        animateFakeSpectrum();
      }).catch(err => console.error('Error al reproducir:', err));
    } else {
      audio.manualPaused = true;
      audio.pause();
      playPauseBtn.textContent = '▶';
      cancelAnimationFrame(animationId);
      isPlaying = false;
      const logo = document.getElementById('logo');
      if(logo) logo.style.transform = 'translateX(-50%) scale(1)';
    }
  });

  // iOS: Forzar carga audio en primer toque
  document.addEventListener('touchstart', () => { audio.load(); }, { once: true });

  // Manejo visibilidad
  document.addEventListener('visibilitychange', () => {
    if(document.visibilityState === 'visible' && isPlaying){
      audio.pause();
      audio.src = '';
      audio.load();
      audio.src = 'https://stream.zeno.fm/yv4pxfcq6igvv';
      audio.play().catch(err => console.error('Error al reanudar el stream:', err));
    }
  });

  audio.addEventListener('stalled', () => {
    setTimeout(() => {
      if(audio.readyState < 3){
        audio.pause();
        audio.src = '';
        audio.load();
        audio.src = 'https://stream.zeno.fm/yv4pxfcq6igvv';
        audio.play().catch(err => console.error('Error al reconectar:', err));
      }
    }, 3000);
  });

  audio.manualPaused = false;
  audio.addEventListener('pause', () => {
    if (isPlaying && !audio.manualPaused) {
      setTimeout(() => {
        audio.play().catch(err => console.warn('No se pudo reanudar audio automáticamente:', err));
      }, 500);
    }
  });

  // Burbuja Android
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    installBubble.style.display = 'block';
  });
  installBubble.addEventListener('click', async () => {
    installBubble.style.display = 'none';
    if(deferredPrompt){
      deferredPrompt.prompt();
      await deferredPrompt.userChoice;
      deferredPrompt = null;
    }
  });

  // Service Worker
  if('serviceWorker' in navigator){
    navigator.serviceWorker.register('service-worker.js')
      .then(() => console.log('Service Worker registrado'))
      .catch(e => console.error('Error registro Service Worker:', e));
  }

  // iOS
  function isIos() { return /iphone|ipad|ipod/i.test(navigator.userAgent); }
  function isInStandaloneMode() { return ('standalone' in window.navigator) && window.navigator.standalone; }
  document.addEventListener('DOMContentLoaded', () => {
    if(isIos() && !isInStandaloneMode() && !localStorage.getItem('iosPromptShown')) {
      iosInstallPrompt.style.display = 'block';
    }
  });
  closeIosPromptBtn.addEventListener('click', () => {
    iosInstallPrompt.style.display = 'none';
    localStorage.setItem('iosPromptShown', 'true');
  });
</script>
</body>
</html>
